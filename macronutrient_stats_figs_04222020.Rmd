---
title: "Fig2_thru_3_nuts_per_cell_jan2020update"
author: "Hannah Reich"
date: "1/21/2020"
output: html_document
---

script updated 4.22.2020 to only include necessary info for ms. original script (~/Desktop/PhD/chapters/chapter 4 - temp treatments/for_coauthors_v1/data_code/code/NEW_fig2_thru_3_nutsPERcell_jan2020)
```{r}
# jan 21 2020.
# remaking C/N/P per cell and metal/cell figures (other rmarkdowns were getting super crowded so made a new one)

# set working directory
setwd("~/Desktop/PhD/chapters/chapter 4 - temp treatments/for_coauthors_v1/data_code/code/")

# load packages
library(ggplot2)
library(ggpubr)
library(readxl)
library(dplyr)
library(reshape2)
library(cowplot)

# read in the metals (and phosphorus)
metals <- read_excel("~/Desktop/PhD/chapters/chapter 4 - temp treatments/for_coauthors_v1/data_code/metallome_um3.xlsx", sheet = "formanova")
# read in the poc and pon per cell
metals <- as.data.frame(metals)
cn <- read.csv("POCPON_cell_edit.csv", header = TRUE)
cn <- as.data.frame(cn)

# make the dataset rbind'able (i.e., make sure factor levels & colnames will match)
colnames(cn) <- c("sampleID","TreatmentID", "Species", "Ironconc", "Temp", "POC", "PON")
cn$sample_ID <- seq.int(nrow(cn))
metals$Species <- factor(metals$Species, levels = c("m", "p"))
levels(metals$Species) <- c("min", "psyg")
cn$Ironconc <- factor(cn$Ironconc, levels =c("100", "50", "10"))
levels(cn$Ironconc) <- c("500 pM Fe'", "250 pM Fe'", "50 pM Fe'")
metals$Ironconc <- factor(metals$Ironconc, levels =c("500", "250", "50"))
levels(metals$Ironconc) <- c("500 pM Fe'", "250 pM Fe'", "50 pM Fe'")

# melt them and THEN rbind them (otherwise POC/PON triplicates get duplicated because icpms data has tech reps)
cn_melt <- reshape2::melt(cn, id.vars=c("sampleID","TreatmentID", "Species", "Ironconc", "Temp", "sample_ID"), measure.vars=c("POC","PON"))
metal_melt <- reshape2::melt(metals, id.vars = c("sample_ID", "Species", "Ironconc", "Temp", "TreatmentID", "sampleID"), measure.vars = c("Cobalt", "Copper", "Iron", "Manganese", "Nickel", "Zinc", "Phosphorus"))

# rbind them together
allnuts <- rbind(cn_melt, metal_melt)
allnuts$Temp <- as.factor(allnuts$Temp)

# separate macro (so lame) and micronutrients. If anyone actually reads this github and agrees trace metals are the coolest but macronutrients get a disproportionate amount of fame, please tweet "Trace metals are the coolest & they MATTER for coral-algal symbiosis #SoMetal @HannahGReich" and I will buy you ice cream (make sure to tag me).
macro <- dplyr::filter(allnuts, variable %in% c("POC", "PON", "Phosphorus"))
micro <- dplyr::filter(allnuts, variable %in% c("Iron", "Copper", "Manganese", "Cobalt", "Nickel", "Zinc"))

### make a plot of the macronutrients, this is figure S6
# change species labels
macro$Species <- factor(macro$Species, levels = c("min", "psyg"))
levels(macro$Species) <- c("B. minutum", "B. psygmphilum")

mac <- ggplot(data=macro, aes(x=Species, y=value, fill=Temp, color=Temp)) +
  geom_boxplot(alpha = 0.5, aes(colour = factor(Temp)), varwidth = FALSE, position = position_dodge(1, preserve = "single")) +
  theme_bw() +
  labs(y="Nutrient/cell", x=element_blank()) +
  theme(panel.grid = element_blank(),
        strip.text = element_text(face = "bold"),
        legend.title = element_text(face = "bold"),
        axis.text.x = element_text(angle=15, vjust=1, hjust =1, face = "italic"),
        axis.title = element_text(face = "bold"),
        legend.position = "right") +
  facet_grid(variable~Ironconc, scales = "free_y") +
  scale_color_manual(values = c("#0072B2","#999999","#D55E00"), name = "Temperature", breaks = c("26", "28", "30"), labels=c("26°C", "28°C", "30°C")) +
  scale_fill_manual(values = c("#0072B2","#999999","#D55E00"), name = "Temperature", breaks = c("26", "28", "30"), labels=c("26°C", "28°C", "30°C"))
mac

# changes made in illustrator: y-axis was revised to include specific units. this wasn't done in R because POC & PON had different units from phosphorus.
save_plot("~/Desktop/PhD/chapters/chapter 4 - temp treatments/for_coauthors_v1/figs/figs_v4_01212020/FigS6_macronutrients.pdf", mac, base_aspect_ratio = 1.9)


```

have the stats in the same place
```{r}
library(PMCMR)

metals$TreatmentID <- as.factor(metals$TreatmentID)
cn$TreatmentID <- as.factor(cn$TreatmentID)
metals$Temp <- as.factor(metals$Temp)
cn$Temp <- as.factor(cn$Temp)
metals$Ironconc <- as.factor(metals$Ironconc)
cn$Ironconc <- as.factor(cn$Ironconc)

# make the sp-specific objects
min_phos <- filter(metals, Species %in% c("min"))
min_cn <- filter(cn, Species %in% c("min"))
psyg_phos <- filter(metals, Species %in% c("psyg"))
psyg_cn <- filter(cn, Species %in% c("psyg"))

### Phosphorus. 
#data is normal but doing non-parametric stats to keep it consistent
shapiro.test(min_phos$Phosphorus)
shapiro.test(psyg_phos$Phosphorus)

kruskal.test(min_phos$Phosphorus, min_phos$TreatmentID)
kruskal.test(min_phos$Phosphorus, min_phos$Temp)
kruskal.test(min_phos$Phosphorus, min_phos$Ironconc)
kruskal.test(psyg_phos$Phosphorus, psyg_phos$TreatmentID)
kruskal.test(psyg_phos$Phosphorus, psyg_phos$Temp)
kruskal.test(psyg_phos$Phosphorus, psyg_phos$Ironconc)

posthoc.kruskal.dunn.test(Phosphorus~TreatmentID, data = min_phos, p.adjust.method = "fdr")
posthoc.kruskal.dunn.test(Phosphorus~TreatmentID, data = psyg_phos, p.adjust.method = "fdr")

### PON 
shapiro.test(min_cn$PON)
shapiro.test(psyg_cn$PON)

kruskal.test(min_cn$PON, min_cn$TreatmentID)
kruskal.test(min_cn$PON, min_cn$Temp)
kruskal.test(min_cn$PON, min_cn$Ironconc)

kruskal.test(psyg_cn$PON, psyg_cn$TreatmentID)
kruskal.test(psyg_cn$PON, psyg_cn$Temp)
kruskal.test(psyg_cn$PON, psyg_cn$Ironconc)

posthoc.kruskal.dunn.test(PON~TreatmentID, data = min_cn, p.adjust.method = "fdr")
posthoc.kruskal.dunn.test(PON~TreatmentID, data = psyg_cn, p.adjust.method = "fdr")

### POC
shapiro.test(min_cn$POC)
shapiro.test(psyg_cn$POC)

kruskal.test(min_cn$POC, min_cn$TreatmentID)
kruskal.test(min_cn$POC, min_cn$Temp)
kruskal.test(min_cn$POC, min_cn$Ironconc)
kruskal.test(psyg_cn$POC, psyg_cn$TreatmentID)
kruskal.test(psyg_cn$POC, psyg_cn$Temp)
kruskal.test(psyg_cn$POC, psyg_cn$Ironconc)

posthoc.kruskal.dunn.test(POC~TreatmentID, data = min_cn, p.adjust.method = "fdr")
posthoc.kruskal.dunn.test(POC~TreatmentID, data = psyg_cn, p.adjust.method = "fdr")

# between species
kruskal.test(cn$POC, cn$Species)
kruskal.test(cn$PON, cn$Species)

summary(min_cn)
summary(psyg_cn)
```

