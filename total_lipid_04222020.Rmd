---
title: "lipid_v01232020"
author: "Hannah Reich"
date: "1/23/2020"
output: html_document
---

aug 2020 update - normalize to cell vol, did not change results

Elise & Artemis Keister analysed abundance of lipid classes on the iron*heat cultures. this is the first pass at figs/stats.

visualize total lipids per samples. script updated 4/22/2020 to remove non total lipid content data. the file with the lipid classes analysis is in ~/summer 2018/culture_lipids
```{r}
# set the working directory
setwd("~/Desktop/PhD/summer 2018/culture_lipids/")

# load packages
library(readxl)
library(dplyr)
library(reshape2)
library(ggplot2)
library(ggpubr)
library(cowplot)
library(PMCMR)

# read in the data
tot <- read_excel("~/Desktop/PhD/summer 2018/culture_lipids/HR_cultures_lipid quant.xlsx", sheet = "for_R_rawdata")
tot <- as.data.frame(tot)

# load volume data in
volused <- read_excel("~/Desktop/PhD/chapters/chapter 4 - temp treatments/for_coauthors_v1/data_code/github_042020/cell_density.xlsx", sheet ="vol")

# calculate the number of cells used
volused$cellslipid <- (volused$CellDensity*volused$mLlipid)
volused$cellvollip <- (volused$cellslipid*volused$VolPerCell)

all <- merge(tot, volused, by = "sampleID")
all$liptot <- (all$total_lipid_mg/all$cellvollip)  

# color palette
cols <-c( "26" = "#0072B2", "28" = "#999999", "30" = "#D55E00")

# make ironconc and temp factors
all$temp <- as.factor(all$temp)
all$ironconc <- as.factor(all$ironconc)
all$species <- as.factor(all$species)
#tot$treatment_ID <- as.factor(tot$treatment_ID)

# make levels fancy
all$species <- factor(all$species, levels = c("min", "psyg"))
levels(all$species) <- c("B. minutum", "B. psygmophilum")
all$ironconc <- factor(all$ironconc, levels =c("100", "50", "10"))
levels(all$ironconc) <- c("500 pM Fe'", "250 pM Fe'", "50 pM Fe'")

# box plot
tot1 <- ggplot(data=all, aes(x=temp, y=liptot, fill=temp, color=temp)) +
  geom_boxplot(alpha = 0.5, aes(colour = factor(temp)), varwidth = FALSE, position = position_dodge(1, preserve = "single")) +
  theme_bw() +
  labs(y="Total lipid (mg/um3 cell)", x=element_blank(), title = "Total lipid/ um3 cell") +
  theme(panel.grid = element_blank(),
        strip.text.x = element_text(face = "bold"),
        strip.text.y = element_text(face = "bold.italic"),
        legend.title = element_text(face = "bold"),
        axis.text.x = element_text(angle=0),
        axis.title = element_text(face = "bold"),
        legend.position = "right") +
  facet_grid(species~ironconc, scales = "free_y") +
  scale_color_manual(values = c("#0072B2","#999999","#D55E00"), name = "Temperature", breaks = c("26", "28", "30"), labels=c("26°C", "28°C", "30°C")) +
  scale_fill_manual(values = c("#0072B2","#999999","#D55E00"), name = "Temperature", breaks = c("26", "28", "30"), labels=c("26°C", "28°C", "30°C")) +
  scale_x_discrete()
tot1


# remake temp factor level
tot$temp <- factor(tot$temp, levels =c("26", "28", "30"))
levels(tot$temp) <- c("26 °C", "28 °C", "30 °C")

## update to have the two species on the same row!
# this is the one used for the manuscript!
tot2 <- ggplot(data=all, aes(x=ironconc, y=liptot, fill=species, color="black")) +
  geom_boxplot(alpha = 0.7, color="black",varwidth = FALSE, position = position_dodge(1, preserve = "single")) +
  theme_bw() +
  labs(y="Total lipid (mg/um3 cell)", x=element_blank(), title = element_blank()) +
  theme(panel.grid = element_blank(),
        strip.text.x = element_text(face = "bold"),
        strip.text.y = element_text(face = "bold.italic"),
        legend.title = element_text(face = "bold"),
        legend.text = element_text(face = "italic"),
        axis.text.x = element_text(angle=20, vjust=1, hjust=1),
        axis.title = element_text(face = "bold"),
        legend.position = "bottom") +
  facet_grid(~temp, scales = "fixed") +
  scale_color_manual(values = c("grey", "black"), breaks = c("B. minutum", "B. psygmophilum"), name = "Species") +
  scale_fill_manual(values = c("grey", "black"), breaks = c("B. minutum", "B. psygmophilum"), name = "Species")
tot2

save_plot("lipid_cell_um3_v2.pdf", tot2, base_aspect_ratio = 1.9)


### do the total lipid stats.

# between species
kruskal.test(all$liptot, all$species)

# within species
bm <- dplyr::filter(all, species %in% c("B. minutum"))
bp <- dplyr::filter(all, species %in% c("B. psygmophilum"))

# normality tests
shapiro.test(bm$liptot)
shapiro.test(bp$liptot)

# KW test
kruskal.test(bm$liptot, bm$temp)
kruskal.test(bm$liptot, bm$ironconc)
kruskal.test(bp$liptot, bp$temp)
kruskal.test(bp$liptot, bp$ironconc)

# post hoc by iron
posthoc.kruskal.dunn.test(liptot~ironconc, data = bm, p.adjust.methods = "fdr")
posthoc.kruskal.dunn.test(liptot~ironconc, data = bp, p.adjust.methods = "fdr")

# post hoc by temp
posthoc.kruskal.dunn.test(liptot~temp, data = bm, p.adjust.methods = "fdr")
posthoc.kruskal.dunn.test(liptot~temp, data = bp, p.adjust.methods = "fdr")



```

